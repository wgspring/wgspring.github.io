---
title: g++的使用
date: 2020-01-04T10:20:38.546Z
coverImage: https://i.loli.net/2020/02/12/OpfQvbim9lK83k5.jpg
categories: 
    - g++
tags: 
---

<!-- toc -->
本文介绍了c++ 编译工具 g++的使用。以下教程只适合`linux`系统
<!-- more -->

## 1. 生成可执行文件

当要求生成可执行文件时，要求代码里面一定要包含main函数，为程序入口。

1. 如果为单文件，例如`main.cpp`，执行：
    - `g++ main.cpp`

    则会生成一个`a.out`文件，该文件即为可执行文件。终端执行`./a.out`即可

2. 如果希望生成的文件名可以指定，则可以使用`-o`参数执行：
    - `g++ main.cpp -o main`

    其中`main`即为你期望生成的文件名

3. 如果为多个文件，可以使用`g++ *.cpp`来通配所有cpp文件

## 2. 生成对象文件 -- *.o

选项 -c 用来告诉编译器编译源代码但不要执行链接，输出结果为对象文件。文件默认名与源码文件名相同，只是将其后缀变为 .o。

`g++ -c main.cpp`

上述命令会生成`main.o`

### 2.1. 对象文件到可执行文件

命令 g++ 能够直接识别 .o 文件并将其作为输入文件传递给链接器。

`g++ main.o`或则`g++ main.o -o main`

生成可执行文件`a.out`或则`main`

## 3. 编译预处理

选项 -E 使 g++ 将源代码用编译预处理器处理后不再执行其他动作。

`g++ -E main.cpp`

上述命令不会生成文件，只会打印预处理的信息，如果要保存到文件可以附加使用`-o`选项

## 4. 生成汇编指令

选项 -S 指示编译器将程序编译成汇编语言，输出汇编语言代码而後结束。

`g++ -S main.cpp`

## 5. 生成静态库

静态库是编译器生成的一系列对象文件(`*.o文件`)的集合。链接一个程序时用库中的对象文件还是目录中的对象文件都是一样的。库中的成员包括普通函数，类定义，类的对象实例等等。静态库的另一个名字叫归档文件(archive)，管理这种归档文件的工具叫 ar 。

`ar -r mylib.a object1.o object2.o`

### 5.1. 静态库到可执行文件

命令 g++ 能够直接识别静态库 `.a` 文件并将其作为输入文件传递给链接器。

`g++ mylib.a`

## 6. 生成动态库

`g++ one.cpp two.cpp three.cpp -fPIC -shared -o libtest.so`

- `-shared`：该选项指定生成动态连接库（让连接器生成T类型的导出符号表，有时候也生成弱连接W类型的导出符号），不用该标志外部程序无法连接。相当于一个可执行文件

- `-fPIC`：表示编译为位置独立的代码，不用此选项的话编译后的代码是位置相关的所以动态载入时是通过代码拷贝的方式来满足不同进程的需要，而不能达到真正代码段共享的目的。

### 6.1. 动态库到可执行文件

例如讲`main.cpp`和动态库`libtest.so`一起链接

`g++ main.cpp -L. -ltest -o main`

- `-L.`：表示要连接的库在当前目录中，`-L`指定动态库目录，`.`表示当前目录
- `-ltest`：编译器查找动态连接库时有隐含的命名规则，即在给出的名字前面加上lib，后面加上.so来确定库的名称。`-l`指定连接的动态库名称，`test`表示`libtest.so`这个文件。

### 6.2. 查看可执行程序链接了哪些库

`ldd main`

