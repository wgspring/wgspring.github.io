---
title: Https如何保证安全性的
date: 2020-03-22T12:09:09+08:00
coverImage: https://s1.ax1x.com/2020/03/22/84zAgS.jpg
categories: 
    - 计算机网络
    - http
tags: 
    - 计算机网络
    - http
---
<!-- toc -->
首先简单介绍http和https的区别：

1. http直接运行在TCP之上，是明文传输；https与TCP之间有一个SSL加密协议，传输内容进过了对称加密。
2. https需要申请证书，用证书确保服务器的可靠性。
3. http的端口为80，https为443

通过上面的区别可以看到，主要体现在对称加密和证书，那么他们是如何保证安全性的呢？

<!-- more -->
## 1. 中间人攻击

对于http协议，中间人攻击（man in the middle）是一种著名的攻击方式。

![](/img/计算机网络/Https%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E5%AE%89%E5%85%A8%E6%80%A7%E7%9A%84/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB.png)

图中John和Mary作为通信的双方，Frank为攻击者
1. John向Mary发送一段数据
2. Frank截获了John的包，窃取/修改数据后，伪装成John继续将包转发给Mary
3. Mary不知道Frank的存在，认为只是收到了来自John的数据，因为返回一段数据给John
4. Frank截获这段返回数据的包，窃取/修改数据后，发送给John

这样，Frank就成功窃取了John和Mary的通信数据，并且John和Mary都不知道Frank的存在。

## 2. https访问过程

Https通过SSL加密，可以有效避免中间人窃取和篡改数据。

一个HTTPS请求实际上包含了两次HTTP传输。第一次请求返回服务器的证书，第二次请求返回加密后的网页数据。其中涉及到三个密钥：
- 服务器端的公钥和私钥，用来进行非对称加密，保证证书有效性并加密客户端生成的随机密钥。
- 客户端生成的随机密钥，用来进行对称加密，防止数据被中间人窃取和修改。

具体访问过程见下图：

![](/img/计算机网络/Https%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E5%AE%89%E5%85%A8%E6%80%A7%E7%9A%84/https%E8%AE%BF%E9%97%AE%E8%BF%87%E7%A8%8B.png)

## 3. 证书检查过程

首先证书以证书链的形式存在
1. 最上层为root，也就是通常所说的CA，用来颁发证书
2. 最下层为end-user，对应每个网站购买使用的证书
3. 中间一层为intermediates，是二级CA，这一层可以继续划分为多层，用来帮助root给end-user颁发证书，这样root只需向intermediates颁发证书

只有当整个证书链上的证书都有效时，才会认定当前证书合法

对于每个证书，会有一对公钥&私钥，公钥加密的数据只有私钥可以解密，私钥加密的数据只有公钥可以解密。私钥由证书所有者保留并且严格保密，公钥则公开使用。

此外，每个证书中还会包含很多信息，比如颁发机构，有效期等，其中最为重要的一个是**签名**。

签名是指利用上一层证书的私钥，加密一些元信息（证书所有者的信息，包括基本信息，公钥，证书生效域名等）。这样，当收到签名证书时，只需要根据CA提供的公钥对签名解密，验证元信息是否一致，就可以判断当前证书是否合法。

![](/img/计算机网络/Https%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E5%AE%89%E5%85%A8%E6%80%A7%E7%9A%84/%E8%AF%81%E4%B9%A6%E7%9A%84%E7%AD%BE%E5%90%8D%E5%92%8C%E9%AA%8C%E8%AF%81.png)

---

系列：
上一篇：{% post_link  %}
下一篇：{% post_link  %}
